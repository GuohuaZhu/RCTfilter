<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>临床试验患者筛选工具</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用 Inter 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 应用中文字体和备用字体 */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
        }
        /* 保持下拉菜单的样式一致性 */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%236b7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25em 1.25em;
            padding-right: 2.5rem; /* 为箭头腾出空间 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container max-w-4xl mx-auto p-4 md:p-8">
        <!-- 标题 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-700">临床试验患者筛选工具</h1>
            <p class="text-gray-600 mt-2">根据患者情况快速匹配可能的临床试验项目</p>
        </header>

        <!-- 筛选器卡片 -->
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                
                <!-- 1. 癌种 -->
                <div>
                    <label for="cancer-type" class="block text-sm font-semibold text-gray-700 mb-2">1. 癌种</label>
                    <select id="cancer-type" class="block w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <option value="all">请选择癌种</option>
                        <option value="ovarian">卵巢癌/输卵管癌/腹膜癌</option>
                        <option value="endometrial">子宫内膜癌</option>
                        <option value="solid-tumor">其他实体瘤</option>
                    </select>
                </div>

                <!-- 2. 治疗线数 -->
                <div>
                    <label for="lines" class="block text-sm font-semibold text-gray-700 mb-2">2. 既往治疗线数</label>
                    <select id="lines" class="block w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <option value="all">请选择线数</option>
                        <option value="1">1 线</option>
                        <option value="2-3">2-3 线</option>
                        <option value=">=4">≥ 4 线</option>
                        <option value="any">不限/其他</option>
                    </select>
                </div>

                <!-- 3. 铂类状态 -->
                <div>
                    <label for="status" class="block text-sm font-semibold text-gray-700 mb-2">3. 铂类状态</label>
                    <select id="status" class="block w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <option value="all">请选择状态</option>
                        <option value="resistant">铂类耐药 (≤6mo)</option>
                        <option value="sensitive">铂类敏感 (>6mo)</option>
                        <option value="sensitive-remission">铂类敏感 (维持治疗)</option>
                        <option value="na">不适用</option>
                    </select>
                </div>

                <!-- 4. 分子靶点 -->
                <div>
                    <label for="target" class="block text-sm font-semibold text-gray-700 mb-2">4. 分子靶点</label>
                    <select id="target" class="block w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <option value="all">不确定/所有靶点</option>
                        <option value="B7-H4">B7-H4</option>
                        <option value="FRα">FRα (叶酸受体α)</option>
                        <option value="HER2">HER2</option>
                        <option value="PARP">PARP 通路</option>
                    </select>
                </div>
            </div>

            <!-- 筛选按钮 -->
            <div class="mt-8">
                <button id="filter-button" class="w-full bg-blue-600 text-white p-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition duration-300 shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    立即筛选
                </button>
            </div>
        </div>

        <!-- 结果区域 -->
        <div id="results" class="space-y-6">
            <!-- 初始提示 -->
            <div id="initial-message" class="text-center text-gray-500 p-10 bg-white rounded-2xl shadow-md">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <h3 class="mt-2 text-lg font-semibold text-gray-700">请选择筛选条件</h3>
                <p class="mt-1 text-sm text-gray-500">选择患者信息后，点击按钮开始筛选。</p>
            </div>
            <!-- 筛选结果将动态插入此处 -->
        </div>
    </div>

    <!-- 
      更新：将试验数据外置到 data.js 文件中，方便维护。
      确保 data.js 在主脚本之前加载。
    -->
    <script src="data.js"></script>

    <script>
        // --- 试验数据库 ---
        // 基于提供的Word文档，将试验的核心入排标准结构化
        // 注意: 'lines' 使用数字数组表示, 99 代表 '≥4' 或 '不限'. 0 代表 '不适用'.
        // const trialsData = [ // 数据已移动到 data.js
                target: 'B7-H4',
                keyPoints: [
                    '癌种：铂耐药型卵巢癌、输卵管癌或原发性腹膜癌',
                    '线数：≥1 线含铂化疗',
                    '状态：铂类耐药 (≤6个月内进展或化疗中进展)',
                    '靶点：B7-H4 (排除标准：既往B7-H4靶点治疗)'
                ]
            },
            {
                id: 'HS-20089-201 (队列2)',
                name: 'HS-20089-201 (队列2)',
                cancer: 'endometrial',
                lines: [1, 2, 3, 99], // ≥1 线
                status: ['resistant', 'na'], // 状态为经含铂化疗后进展，归为 '耐药' 或 'N/A'
                target: 'B7-H4',
                keyPoints: [
                    '癌种：复发性或转移性子宫内膜癌',
                    '线数：≥1 线含铂标准化疗后进展',
                    '状态：标准治疗进展或不耐受',
                    '靶点：B7-H4 (排除标准：既往B7-H4靶点治疗)'
                ]
            },
            {
                id: 'HS-20089-201 (队列3)',
                name: 'HS-20089-201 (队列3)',
                cancer: 'ovarian',
                lines: [1, 2, 3, 99], // ≥1 线
                status: ['sensitive'],
                target: 'B7-H4',
                keyPoints: [
                    '癌种：铂敏感复发卵巢癌、输卵管癌或原发性腹膜癌',
                    '线数：≥1 线含铂标准化疗',
                    '状态：铂类敏感 (无铂间期 ≥6个月)',
                    '靶点：B7-H4 (排除标准：既往B7-H4靶点治疗)'
                ]
            },
            {
                id: 'HS-20089-201 (队列4)',
                name: 'HS-20089-201 (队列4)',
                cancer: 'solid-tumor',
                lines: [0, 1, 2, 3, 99], // 任何线
                status: ['na'],
                target: 'B7-H4',
                keyPoints: [
                    '癌种：其他晚期实体瘤',
                    '线数：不限',
                    '状态：无标准治疗或标准治疗不耐受',
                    '靶点：B7-H4 (排除标准：既往B7-H4靶点治疗)'
                ]
            },
            {
                id: 'HS-20089-201 (队列5)',
                name: 'HS-20089-201 (队列5)',
                cancer: 'ovarian',
                lines: [2, 3, 99], // ≥2 线
                status: ['sensitive'],
                target: 'B7-H4',
                keyPoints: [
                    '癌种：铂敏感复发卵巢癌、输卵管癌或原发性腹膜癌',
                    '线数：≥2 线含铂标准化疗',
                    '状态：铂类敏感 (无铂间期 ≥6个月)',
                    '核心：既往需 PARP 抑制剂经治',
                    '靶点：B7-H4 (排除标准：既往B7-H4靶点治疗)'
                ]
            },
            {
                id: 'HS-20089-301',
                name: 'HS-20089-301',
                cancer: 'ovarian',
                lines: [1, 2, 3], // 1-3 线
                status: ['resistant'],
                target: 'B7-H4',
                keyPoints: [
                    '癌种：铂耐药型卵巢癌、输卵管癌或原发性腹膜癌',
                    '线数：1-3 线系统性抗肿瘤治疗',
                    '状态：铂类耐药 (≤6个月内进展)',
                    '核心：排除原发铂难治 (一线<3个月进展)',
                    '靶点：B7-H4 (排除既往B7-H4治疗)，且排除 FRα 阳性'
                ]
            },
            {
                id: 'Fuzuloparib+Apatinib',
                name: '氟唑帕利联合阿帕替尼 (维持治疗)',
                cancer: 'ovarian',
                lines: [2, 3], // 2-3 次含铂方案
                status: ['sensitive-remission'], // 铂敏感复发后的维持
                target: 'PARP',
                keyPoints: [
                    '癌种：高级别浆液性卵巢癌等',
                    '线数：既往 2 或 3 次含铂方案治疗',
                    '状态：铂类敏感 (倒数第二次 >6个月)，末次含铂化疗后缓解(CR/PR)',
                    '核心：用于末次含铂化疗后的维持治疗',
                    '靶点：PARP 通路'
                ]
            },
            {
                id: 'BAT8006 (FRα)',
                name: 'BAT8006 (FRα 试验)',
                cancer: 'ovarian',
                lines: [1, 2, 3], // ≤3 线
                status: ['resistant'],
                target: 'FRα',
                keyPoints: [
                    '癌种：铂耐药晚期卵巢癌、原发性腹膜癌以及输卵管癌',
                    '线数：≤3 线治疗',
                    '状态：铂类耐药 (特定定义，排除一线<3个月复发)',
                    '核心：BRCA+ 须 PARPi 经治',
                    '靶点：需提供肿瘤样本评估 FR-α 状态'
                ]
            },
            {
                id: 'BAT8006 (HER2)', // 文档中标题重复，但内容指向HER2
                name: 'BAT8006 (HER2 试验)',
                cancer: 'ovarian',
                lines: [1, 2, 3, 99], // ≥1 线
                status: ['resistant'], // 特定铂耐药定义
                target: 'HER2',
                keyPoints: [
                    '癌种：局部晚期不可切除或转移性卵巢癌等',
                    '线数：≥1 线含铂化疗',
                    '状态：铂类耐药 (特定定义，1线 >3且<6mo，2线+ <6mo)',
                    '核心：BRCA+ 须 PARPi 经治; FRα+ 须 MIRV 经治',
                    '靶点：HER2 表达 (IHC 1+, 2+, 3+)'
                ]
            }
        // ]; // 数据已移动到 data.js

        // --- 筛选逻辑 ---

        const filterButton = document.getElementById('filter-button');
        const resultsContainer = document.getElementById('results');
        const initialMessage = document.getElementById('initial-message');

        filterButton.addEventListener('click', filterTrials);

        /**
         * 将下拉框选择的线数转换为数字数组
         * @param {string} linesValue - 下拉框的 value
         * @returns {number[]} - 对应的线数数组
         */
        function getSelectedLines(linesValue) {
            switch (linesValue) {
                case '1':
                    return [1];
                case '2-3':
                    return [2, 3];
                case '>=4':
                    return [99]; // 99 代表 4线及以上
                case 'any':
                    return [0, 1, 2, 3, 99]; // 0 代表 N/A
                case 'all':
                    return [0, 1, 2, 3, 99];
                default:
                    return [0, 1, 2, 3, 99];
            }
        }

        /**
         * 主筛选函数
         */
        function filterTrials() {
            // 确保 trialsData 已加载
            if (typeof trialsData === 'undefined') {
                console.error('试验数据 (data.js) 未加载。');
                resultsContainer.innerHTML = `
                    <div class="text-center text-red-500 p-10 bg-white rounded-2xl shadow-md">
                        <h3 class="mt-2 text-lg font-semibold">加载错误</h3>
                        <p class="mt-1 text-sm">无法加载试验数据 (data.js)，请检查文件是否存在。</p>
                    </div>
                `;
                if (initialMessage) {
                    initialMessage.style.display = 'none';
                }
                return;
            }

            // 隐藏初始消息
            if (initialMessage) {
                initialMessage.style.display = 'none';
            }

            // 1. 获取所有筛选值
            const selectedCancer = document.getElementById('cancer-type').value;
            const selectedLinesValue = document.getElementById('lines').value;
            const selectedStatus = document.getElementById('status').value;
            const selectedTarget = document.getElementById('target').value;

            // 2. 转换线数值
            const selectedLinesArray = getSelectedLines(selectedLinesValue);

            // 3. 过滤试验
            const filteredTrials = trialsData.filter(trial => {
                // 检查癌种
                const cancerMatch = (selectedCancer === 'all' || trial.cancer === selectedCancer);

                // 检查线数 (数组是否有交集)
                const linesMatch = (selectedLinesValue === 'all' || trial.lines.some(line => selectedLinesArray.includes(line)));

                // 检查铂类状态
                const statusMatch = (selectedStatus === 'all' || trial.status.includes(selectedStatus));

                // 检查靶点
                const targetMatch = (selectedTarget === 'all' || trial.target === selectedTarget);

                return cancerMatch && linesMatch && statusMatch && targetMatch;
            });

            // 4. 渲染结果
            renderResults(filteredTrials);
        }

        /**
         * 将筛选结果渲染到页面
         * @param {Array} trials - 筛选后的试验数组
         */
        function renderResults(trials) {
            // 清空旧结果
            resultsContainer.innerHTML = '';

            if (trials.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="text-center text-gray-500 p-10 bg-white rounded-2xl shadow-md">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                        </svg>
                        <h3 class="mt-2 text-lg font-semibold text-gray-700">未找到匹配的试验</h3>
                        <p class="mt-1 text-sm text-gray-500">请尝试放宽您的筛选条件。</p>
                    </div>
                `;
                return;
            }

            // 按靶点分组
            const groupedByTarget = trials.reduce((acc, trial) => {
                const target = trial.target || '其他';
                if (!acc[target]) {
                    acc[target] = [];
                }
                acc[target].push(trial);
                return acc;
            }, {});

            // 循环渲染每个分组
            for (const target in groupedByTarget) {
                // 创建分组标题
                const groupContainer = document.createElement('div');
                groupContainer.className = 'mb-8';
                
                const groupTitle = document.createElement('h2');
                groupTitle.className = 'text-2xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-200';
                groupTitle.innerHTML = `
                    <span class="inline-block bg-blue-600 text-white rounded-full px-4 py-1 text-lg mr-2">${target}</span> 靶点项目
                `;
                groupContainer.appendChild(groupTitle);

                // 循环渲染分组内的试验
                groupedByTarget[target].forEach(trial => {
                    const trialCard = document.createElement('div');
                    trialCard.className = 'bg-white p-6 rounded-2xl shadow-lg mb-4 border border-gray-200 hover:shadow-xl transition-shadow duration-300';
                    
                    // 试验标题
                    const title = `<h3 class="text-xl font-bold text-green-700">${trial.name}</h3>`;
                    
                    // 核心要点
                    const pointsList = trial.keyPoints.map(point => `
                        <li class="flex items-start py-1">
                            <svg class="w-5 h-5 text-green-500 mr-3 flex-shrink-0 mt-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span class="text-gray-700">${point.replace(/：/g, '：<strong class="font-semibold text-gray-800">').replace(/核心：/g, '核心：<strong class="font-semibold text-red-600">')}</strong></span>
                        </li>
                    `).join('');

                    trialCard.innerHTML = `
                        ${title}
                        <ul class="mt-4 space-y-2 list-none">
                            ${pointsList}
                        </ul>
                    `;
                    groupContainer.appendChild(trialCard);
                });
                
                resultsContainer.appendChild(groupContainer);
            }
        }
    </script>
</body>
</html>

